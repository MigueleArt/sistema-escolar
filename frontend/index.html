<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... (tu head se mantiene igual) ... -->
    <title>Sistema de Gestión Escolar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .view { display: none; }
        .view.active { display: block; }
        .nav-link { transition: all 0.2s ease-in-out; }
        /* ... (tus otros estilos se mantienen igual) ... */
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- ... (tu HTML se mantiene igual) ... -->

    <script>
        // --- ESTADO DE LA APLICACIÓN ---
        const AppState = { currentUser: null, materias: [], inscripciones: [], pagos: [] };

        // --- API REAL (Llamadas a microservicios a través del Gateway en Render) ---
        // URL PÚBLICA DE TU API GATEWAY
        const API_BASE_URL = 'https://api-gateway-bimt.onrender.com/api';

        const api = {
            login: (matricula, password) => new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (matricula === '12345' && password === 'password123') {
                        resolve({
                            nombre: 'Juan Alumno',
                            matricula: '12345',
                            email: 'juan.alumno@universidad.edu',
                            carrera: 'Ingeniería en Sistemas Computacionales',
                            cuatrimestre: '5to',
                            grupo: 'A'
                        });
                    } else {
                        reject('Credenciales inválidas');
                    }
                }, 1000);
            }),
            getMaterias: async () => {
                 try {
                    // En este caso, para obtener las materias, podríamos llamar directamente
                    // al servicio de inscripciones o a través del gateway.
                    // Usemos el gateway para mantener la consistencia.
                    const response = await fetch('https://servicio-inscripciones-escolar.onrender.com/materias');
                    if (!response.ok) throw new Error('Error al cargar las materias');
                    const materias = await response.json();
                    AppState.materias = materias;
                    return materias;
                } catch (error) {
                    console.error("Error en getMaterias:", error);
                    alert(`Error al cargar materias: ${error.message}`);
                    return [];
                }
            },
            inscribirMateria: async (materiaId) => {
                const response = await fetch(`${API_BASE_URL}/inscripciones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ materiaId })
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.error);
                AppState.inscripciones.push({ materiaId, status: 'PENDIENTE_PAGO' });
                return result;
            },
            realizarPago: async (inscripcion) => {
                const response = await fetch(`${API_BASE_URL}/pagos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ inscripcionId: inscripcion.materiaId })
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.error);
                
                const inscripcionIndex = AppState.inscripciones.findIndex(i => i.materiaId === inscripcion.materiaId);
                if (inscripcionIndex !== -1) {
                  AppState.inscripciones[inscripcionIndex].status = 'INSCRITO';
                }
                
                const materia = AppState.materias.find(m => m.id === inscripcion.materiaId);
                if (materia) materia.inscritos++;
                
                return result;
            }
        };

        // --- (El resto de tu código JavaScript se mantiene igual) ---
        // --- MANEJO DE VISTAS Y NAVEGACIÓN ---
        const loginView = document.getElementById('login-view');
        // ...
    </script>
</body>
</html>

